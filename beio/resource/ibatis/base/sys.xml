<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
	"http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="sys">

	<!-- 查询正则 -->
	<select id="queryRegex" parameterType="SysRegex" resultType="SysRegex">
		select * from sys_regex;
	</select>
	
	<!-- 查询提示 -->
	<select id="queryTipMsg" parameterType="SysTipMsg" resultType="SysTipMsg">
		select * from sys_tipmsg;
	</select>
	
	<!-- 短信日志 -->
	<insert id="insertSmsLog" parameterType="SysSmsLog">
		insert into sys_smslog(id, mobile, message, status, category, creator, createTime) 
			values(#{id}, #{mobile}, #{message}, #{status}, #{category}, #{creator}, #{createTime});
	</insert>

	<!-- 请求日志 -->
	<insert id="insertVisitLog" parameterType="SysVisitLog">
		insert into sys_visitlog(id, ip, action, param, address, creator, createTime) 
			values(#{id}, #{ip}, #{action}, #{param}, #{address}, #{creator}, #{createTime});
	</insert>
	
	<!-- 查询会员 -->
	<select id="queryMember" parameterType="SysMember" resultType="SysMember">
		select * from sys_member where 1=1
		<if test="mobile != null and mobile != ''">
			and mobile = #{mobile}
		</if>
		<if test="id != null and id != ''">
			and id = #{id}
		</if>
		order by createTime limit 1;
	</select>
	
	<!-- 短信验证码 -->
	<select id="querySmsVerify" parameterType="String" resultType="String">
		select message from sys_smslog where mobile = #{mobile} and category = '01' order by createTime desc limit 1;
	</select>

	<!-- 会员注册 -->	
	<insert id="register" parameterType="SysMember">
		insert into sys_member(mobile, password, email, level, turnonTime, expireTime, creator, createTime, modifier, modifyTime)
			values(#{mobile}, #{password}, #{email}, #{level}, #{turnonTime}, #{expireTime}, #{creator}, #{createTime}, #{modifier}, #{modifyTime});
	</insert>
	
	<!-- 会员登录 -->
	<select id="login" parameterType="SysMember" resultType="SysMember">
		select * from sys_member where mobile = #{mobile} and BINARY password = #{password} order by createTime limit 1;
	</select>
	
	<!-- 找回密码 -->
	<update id="findPwd" parameterType="SysMember">
		update sys_member set password = #{password} where mobile = #{mobile};
	</update>
	
	<!-- 修改个人信息 -->
	<update id="modifyMemberInfo" parameterType="SysMember">
		update sys_member  
		<set>
			sex = #{sex},
			email = #{email},
			hobby = #{hobby},
			nickName = #{nickName},
			birthday = #{birthday},
		</set>
		where id = #{id};
	</update>
	
</mapper>